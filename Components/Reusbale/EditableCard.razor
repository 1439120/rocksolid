@using System.Security.Cryptography
@using BlazorApp.Models
@inject NavigationManager NavManager

<div class="card shadow-sm border-0 rounded-4 m-3" style="width: 360px;">
  <div class="card-body p-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h5 class="fw-bold mb-1 text-primary">@Title</h5>
        <small class="text-muted">Prime Interest: @MinLinkedInterest% â€¢ Up to @MaxLinkedInterest%</small>
      </div>
      <span class="badge bg-light text-dark border">Up to <strong>R @MaxLoanAmount.ToString("N2")</strong></span>
    </div>

    @foreach(var tag in Tags){
        <p class="fs-6 px-3 rounded-4 text-white" style="@RandomColors()">@tag.Name</p>
    }

    <!-- Divider -->
    <hr class="my-3"/>

    <!-- Actions -->
    <div class="d-flex justify-content-end gap-2">
      <NavLink class="btn btn-sm btn-outline-primary px-3"  Match="NavLinkMatch.All" href="@EditLink">
          <i class="bi bi-pencil"></i> Edit
      </NavLink>
      <button class="btn btn-sm btn-outline-danger px-3" @onclick="() => DeleteWithDelay()">
        <i class="bi bi-trash"></i> Delete
    </button>
    </div>
  </div>
</div>

@code{
    [Parameter] public string? Title{get; set;}
    [Parameter] public float MinLinkedInterest{get; set;}
    [Parameter] public float MaxLinkedInterest{get; set;}
    [Parameter] public float MaxLoanAmount{get; set;}
    [Parameter] public List<LoanOffersTags> Tags{get; set;} = new();
    [Parameter] public string EditLink{get; set;} = string.Empty;
    [Parameter] public string DeleteLink{get; set;} = string.Empty;

    string RandomColors(){
        var styling = "width: fit-content;";
        string[] colors = ["background-color: rgb(2, 161, 82);","background-color: rgb(60, 2, 161);","background-color: rgb(5, 140, 218);",
                            "background-color: rgb(130, 6, 39);","background-color: rgb(74, 6, 130);","background-color: rgb(176, 77, 47);"];
        styling += colors[RandomNumberGenerator.GetInt32(colors.Length)];
        return styling;
    }

    private void DeleteWithDelay()
    {
        NavManager.NavigateTo(DeleteLink, forceLoad: true);
    }
}    
