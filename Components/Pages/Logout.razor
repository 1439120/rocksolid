@page "/logout"
@inject FirebaseAuthentication FirebaseAuth
@inject AuthenticationStateProvider authStateProvider
@inject NavigationManager navManager

<h3>Logging out...</h3>

@code{
    protected override async Task OnInitializedAsync()
    {
        await UnAuthenticate();
    }
    private async Task UnAuthenticate()  // ‚úÖ FIXED: async Task (not async void)
    {
        Console.WriteLine("üîê Logging out...");
        
        // 1. Clear Firebase auth
        FirebaseAuth.Logout();
        
        // 2. Clear custom cache auth
        var customAuthStateProvider = (CustomAuthenticationProvider)authStateProvider;
        await customAuthStateProvider.UpdateAuthenticationState(null);  // ‚úÖ Await this!
        
        // 3. Force UI refresh
        StateHasChanged();  // ‚úÖ Uncommented
        
        // 4. Navigate AFTER cache is cleared
        navManager.NavigateTo("/dashboard", true);
        
        Console.WriteLine("‚úÖ Logout complete!");
    }
}