@page "/dashboard"
<PageTitle>Dashboard</PageTitle>
@using BlazorApp.Components.Reusbale
@using Microsoft.AspNetCore.Components.Authorization
@using BlazorApp.Models;
@inject ClientDatabaseService ClientDbService

<div class="dashboard-header">
    <h1>Dashboard</h1>
    <AuthorizeView>
        <Authorized>
            <p>Hello <strong>@User?.Name @User?.Surname</strong></p>
        </Authorized>
    </AuthorizeView>
</div>

<div class="d-flex flex-row gap-2 justify-content-between mt-10">
    <Card Title="Paid Amount" IconColor="green" BiIcon=IconName.DollarSign Comment="Amount available in bank for clients to lend" Value="R420000.00"/>
    <Card Title="Oustanding Balance" IconColor="blue" BiIcon=IconName.GraphUpArrow Comment="Total amount that needs to be paid by clients" Value="R311000.00"/>
    <Card Title="Interest Paid" IconColor="orange" BiIcon=IconName.CashCoin Comment="Interest paid" Value="6"/>
    <Card Title="Total Loans" IconColor="red" BiIcon=IconName.ExclamationOctagon Comment="Total loan offered" Value="1"/>
</div>


<AuthorizeView>
    <Authorized>
        <div>
            <div class="mt-3">
                <p class="fs-3 fw-bold">All Loans</p>
            </div>
        </div>
        <div class="my-4 d-flex gap-5 m-5">
            <LoanCard Title="Personal Loan" LoanItems="@PersonalLoanItems" TitleColor="blue" LoanType="@LoanTypes.Personal"/>
            <LoanCard Title="House Loan" LoanItems="@HouseLoanItems" TitleColor="grey" LoanType="@LoanTypes.Home"/>
            <LoanCard Title="Car Loan" LoanItems="@CarLoanItems" TitleColor="orange" LoanType="@LoanTypes.Car"/>
        </div>
    </Authorized>
    <NotAuthorized>
        <span class="m-3">
            To manage and access your funds click the login link
            <NavLink href="/login">
                <span class="bi bi-bank-nav-menu" aria-hidden="true"></span> login
            </NavLink>
        </span>
    </NotAuthorized>
</AuthorizeView>



<div class="d-flex flex-wrap gap-4 align-items-start">
    <div class="card shadow-sm border-0 rounded-4 p-3 w-75 d-flex align-items-center justify-content-center pb-5" style="height: 400px;">
        <p style="font-size: 100px; font-weight: 800; color:rgb(60, 60, 87);">RockSolid</p>
        <p class="text-secondary fs-4">Reliable source of money you can trust. Apply anytime anywhere and your money is on the way.</p>
    </div>
    <div class="card shadow-sm border-0 rounded-4 p-3 text-center" style="max-width: 350px;">
        <div class="card-body">
            <h4 class="card-title fw-bold text-primary mb-3">Why Choose Us?</h4>
            <ul class="list-unstyled text-secondary mb-4">
                <li class="mb-3">
                    <i class="bi bi-award me-2 text-warning fs-4"></i>
                    <span class="fw-semibold">Trusted by Thousands</span>
                    <div class="small">We have served over 10,000 satisfied clients</div>
                </li> 
                <li class="mb-3">
                    <i class="bi bi-shield-check me-2 text-success fs-4"></i>
                    <span class="fw-semibold">Reliable Service</span>
                    <div class="small">Fast approvals and consistent support every step</div>
                </li>
                <li class="mb-3">
                    <i class="bi bi-people me-2 text-info fs-4"></i>
                    <span class="fw-semibold">Expert Team</span>
                    <div class="small">Our experienced staff guide you through every loan process</div>
                </li>
            </ul>
            <button class="btn btn-outline-primary rounded-pill w-75 fw-semibold">
                Learn More
            </button>
        </div>
    </div>
    
</div>
    

@code{
    private ClientDatabase? User;
    private LoanFeature[] PersonalLoanItems = [
    new LoanFeature{IconName=IconName.CashCoin, Text="Borrow up to <strong>R25,000</strong>", IconColor="green"},
    new LoanFeature{IconName=IconName.Clock, Text="Get approved within <strong>24 hours</strong>", IconColor="blue"},
    new LoanFeature{IconName=IconName.ShieldCheck, Text="Flexible repayment options", IconColor="orange"}];

    private LoanFeature[] HouseLoanItems = [
    new LoanFeature{IconName=IconName.HouseDoor, Text="Borrow up to <strong>R1,000,000</strong>", IconColor="green"},
    new LoanFeature{IconName=IconName.Clock, Text="Approval within <strong>48 hours</strong>", IconColor="blue"},
    new LoanFeature{IconName=IconName.ShieldCheck, Text="Long-term repayment options", IconColor="orange"}];

    private LoanFeature[] CarLoanItems = [
    new LoanFeature{IconName=IconName.CarFront, Text="Borrow up to <strong>R500,000</strong>", IconColor="green"},
    new LoanFeature{IconName=IconName.Clock, Text="Get approved within <strong>24 hours</strong>", IconColor="blue"},
    new LoanFeature{IconName=IconName.ShieldCheck, Text="Flexible repayment terms", IconColor="orange"}];

    protected override async Task OnInitializedAsync()
    {
        
        if(authenticationState != null){
            var authState = await authenticationState;
            var userClaims = authState.User;

            var userId = userClaims.FindFirst("UserId")?.Value;

            if (!string.IsNullOrEmpty(userId))
            {
                var users = await ClientDbService.GetClientByUserId(userId);
                User = users.FirstOrDefault();
            }
        }
        
    }


    [CascadingParameter]
    private Task<AuthenticationState>? authenticationState{get; set;}
}